import subprocess
import re
import numpy
from datetime import datetime
import os
seeds = [
    950772, 318235, 342386, 992392, 529848, 348276, 633513, 192046, 817400, 748153, 189686, 476481, 674836, 811108,
    813038, 878264, 303319, 295204, 153826, 202849, 105416, 667408, 79531, 456592, 757733, 161826, 877071, 544189,
    72085, 348280, 311693, 34929, 388396, 711863, 383301, 610161, 747649, 126925, 921425, 263000, 455107, 808129,
    159749, 344504, 314421, 212438, 237513, 228820, 631076, 83444, 46599, 625511, 292356, 568760, 491920, 560300,
    725948, 847773, 964507, 56828, 852366, 634298, 262377, 809313, 147467, 358229, 106787, 613343, 696266, 107735,
    765693, 439594, 865703, 300872, 573271, 421082, 872803, 767455, 872122, 863070, 672990, 645266, 507256, 911013,
    278633, 916998, 27675, 601044, 414962, 696706, 113966, 529041, 627034, 327983, 569191, 74656, 765204, 969836,
    739889, 227093, 258461, 805576, 111225, 347755, 269045, 77763, 124884, 906277, 134441, 479484, 841402, 597004,
    993786, 377883, 785437, 346548, 9527, 817593, 949148, 13740, 29780, 343073, 24605, 308046, 83642, 210045, 48980,
    565385, 118475, 487530, 343937, 841870, 436643, 117112, 760371, 114898, 96737, 239107, 359805, 268451, 711085,
    185207, 940636, 685827, 216561, 510445, 481490, 756807, 326056, 920280, 369360, 90810, 765790, 415590, 724228,
    165935, 904493, 381938, 159001, 955267, 962913, 17950, 306247, 143553, 811085, 677286, 535089, 573066, 235752,
    972561, 128816, 616089, 614479, 474191, 91775, 868618, 936167, 989718, 829010, 287260, 524029, 617224, 458104,
    793749, 278148, 901208, 719206, 621883, 702807, 503173, 51146, 420181, 481519, 381741, 296347, 937606, 789175,
    201952, 356781, 815926, 750204, 597754, 909343, 452213, 218186, 812826, 697796, 82949, 124155, 418962, 60899,
    740581, 377949, 543074, 35174, 374847, 860282, 23942, 227624, 970741, 147579, 36408, 453529, 144120, 27709, 930565,
    410733, 606300, 967584, 902339, 597106, 157204, 610312, 667323, 380662, 202069, 857516, 75776, 726598, 4356, 3944,
    172035, 325390, 751928, 263301, 351407, 565910, 910779, 713394, 69259, 601605, 478734, 881344, 944266, 217360,
    229355, 558725, 215582, 956659, 344378, 723409, 654735, 337780, 369616, 500941, 936249, 549323, 393648, 246862,
    217631, 323894, 836539, 150558, 212498, 463574, 396630, 816962, 359593, 98357, 771501, 942186, 39936, 55950, 232924,
    187087, 440377, 129837, 85541, 259120, 73590, 974464, 755515, 381197, 372990, 216575, 307734, 676338, 319234,
    209936, 176312, 849231, 483503, 175583, 798433, 468699, 849303, 457422, 80012, 206009, 806423, 112800, 930601,
    88163, 1272, 835102, 48181, 391379, 443815, 339846, 147460, 270943, 730285, 47471, 929576, 612258, 383084, 16334,
    965541, 918195, 257969, 618782, 814142, 535051, 238079, 195647, 351226, 941214, 652249, 803710, 833382, 932521,
    849012, 993259, 739280, 585223, 495858, 785502, 48363, 479354, 746401, 675314, 759971, 712545, 226830, 686252,
    705967, 250230, 682262, 384486, 686895, 391405, 884757, 987238, 265807, 500869, 334494, 820632, 758964, 680705,
    888771, 255075, 715429, 595992, 153272, 775666, 664500, 503086, 244462, 175132, 357124, 168668, 789633, 560958,
    419798, 404200, 882301, 435947, 587746, 939906, 773773, 314887, 955246, 434868, 847767, 895145, 58501, 383907,
    733670, 544267, 760184, 309832, 506718, 938882, 871852, 956489, 408339, 344022, 358505, 379798, 356493, 39140,
    726696, 728498, 169612, 945031, 508443, 844311, 252369, 866929, 878585, 173419, 809484, 825686, 755054, 693863,
    464478, 780755, 682118, 944758, 350176, 501030, 883328, 177223, 50210, 713928, 321929, 819890, 817219, 773543,
    633969, 375759, 299370, 412890, 391030, 262209, 291379, 597916, 433184, 218231, 938989, 963055, 124723, 436701,
    695666, 71635, 247982, 930770, 238925, 437434, 145295, 757231, 163554, 679692, 690424, 605181, 24516, 905862,
    516457, 267209, 682323, 423768, 612979, 652677, 95676, 577145, 672449, 577053, 502313, 123661, 995859, 944325,
    293596, 163899, 59037, 311234, 501102, 892721, 521194, 689377, 678891, 220394, 508118, 344496, 790943, 917501,
    292457, 385277, 881355, 875425, 879434, 858412, 617174, 441162, 468907, 751414, 198691, 156299, 43717, 466276,
    659249, 726259, 173176, 907543, 443990, 222166, 75050, 805558, 337011, 598200, 811522, 934082, 763202, 728939,
    831554, 269152, 850459, 70817, 753832, 500387, 864663, 332620, 901250, 148262, 736729, 516853, 792400, 596210,
    925124, 35582, 802459, 830312, 15966, 149391, 492529, 800245, 490763, 874744, 173028, 384321, 519062, 926710,
    141019, 543719, 562930, 155574, 442135, 902196, 406006, 960935, 100959, 156823, 870091, 15958, 213417, 359979, 9340,
    339637, 395129, 202405, 187561, 908909, 259212, 753768, 467037, 901280, 121115, 929857, 114655, 968052, 144846,
    33345, 447784, 717463, 217585, 992096, 996079, 598090, 172082, 614170, 4909, 768332, 185044, 349910, 317497, 209175,
    236741, 657971, 500423, 977808, 264136, 409365, 626985, 347537, 350414, 881350, 979762, 909235, 966587, 183484,
    337600, 425926, 36794, 857023, 836493, 33444, 181057, 540484, 896591, 896876, 124235, 200840, 75145, 25548, 545198,
    458198, 727142, 70994, 906266, 39350, 279944, 250624, 418789, 727213, 989382, 767475, 190300, 450951, 420474,
    325685, 191845, 303613, 684630, 995670, 814634, 205325, 633832, 117086, 324677, 302047, 15829, 159837, 629540,
    994944, 772958, 538175, 240669, 881421, 640290, 832845, 541166, 66689, 376983, 355970, 468320, 87364, 92137, 646674,
    741422, 921796, 364640, 274206, 3260, 733481, 105339, 744978, 127428, 440480, 470747, 943819, 647494, 467187,
    395599, 137612, 674443, 675853, 960315, 522969, 151655, 584435, 756299, 781134, 246000, 283132, 649628, 132289,
    796490, 896614, 960356, 839797, 500343, 258517, 682065, 540394, 399484, 660612, 58453, 399208, 508201, 670398,
    28977, 907912, 485022, 574831, 770212, 157294, 95546, 802815, 219356, 29348, 241607, 701355, 883609, 80883, 947542,
    376680, 550245, 112209, 444919, 966354, 482137, 960312, 774969, 436008, 91387, 501834, 978576, 387215, 574355,
    968958, 389362, 533328, 591156, 399709, 253230, 198264, 988433, 862297, 90899, 260680, 808178, 508893, 710216,
    467710, 527854, 190010, 4892, 881988, 894179, 537642, 328300, 425677, 224184, 452436, 700275, 159540, 251494,
    135571, 719255, 169475, 416018, 471053, 430492, 72406, 737881, 939002, 381605, 655159, 491598, 311012, 749626,
    454817, 932457, 110206, 884278, 699088, 502320, 711862, 873636, 670846, 441422, 468664, 7173, 18075, 311041, 181092,
    818729, 382351, 276072, 460040, 114541, 861558, 646593, 7094, 56136, 779733, 860410, 600904, 60250, 992063, 567598,
    124603, 557649, 219553, 829350, 958833, 655994, 8251, 40530, 977516, 438856, 147065, 873089, 29671, 58548, 813632,
    323874, 727873, 458063, 755815, 117916, 608766, 597664, 520806, 156089, 934177, 161793, 692262, 593176, 335278,
    332415, 110396, 229965, 427804, 282255, 629142, 205918, 197947, 574656, 422126, 562675, 62728, 950107, 953853,
    357767, 713965, 923359, 610378, 682, 600770, 837591, 510464, 925391, 409192, 784098, 734314, 321724, 995300, 519211,
    826715, 514490, 416645, 248026, 39738, 562685, 880657, 134430, 862801, 258321, 764336, 977020, 519566, 679141,
    118745, 265227, 553246, 975113, 270566, 234011, 28169, 240805, 741161, 111218, 966628, 360117, 177972, 22890,
    810998, 349316, 46233, 284083, 301038, 787361, 65626, 378981, 619856, 291798, 298310, 386133, 843450, 446632,
    300198, 612611, 423031, 583832, 98465, 732587, 154815, 136949, 294079, 208767, 741911, 55610, 11597, 857895, 659507,
    107081, 950745, 714291, 932731, 401449, 102465, 963834, 135968, 117155, 747762, 464753, 378220, 408194, 673029,
    315677, 31942, 861284, 974227, 595916, 139293, 279354, 263964, 497816, 864402, 324216, 664230, 448324, 944899,
    802194, 128320, 529969, 594911, 332164, 437954, 351148, 860902, 338115, 594680, 360165, 810026, 36690, 668477,
    683116, 175906, 717349, 420544, 362192, 515197, 717685, 911978, 851010, 665661, 915903, 520818, 368413, 828697,
    131176, 719183, 304611, 299156, 110127, 290186, 880097, 79410, 362371, 336106, 97403, 806887, 650903, 341841,
    317639, 770873, 648082, 664258, 658198]
results = []
count = 100

score_pattern = re.compile('END [(]latest message[)]: SCORE (\\d+)')

exes = ['x64/Release/Wololo2.exe']
results = []
prefix = os.path.join(r'C:\logs',str(datetime.now()).replace(':','_').replace('.','_').replace(' ','_'))
jj = 0
for i in range(0, count):
    print(f'Running {i}')
    for e in exes:
        jj = jj+1
        p1 = subprocess.Popen(['./console.runner/bin/ConsoleRunner.exe', '-e', e,
                           '--host', 'ecovpn.dyndns.org', '--port', '11222', '-m', str(seeds[i])
                           ], stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
        res = p1.communicate()
        res = res[0].decode()
        rr = -1
        desc = None
        for l in res.splitlines():
          if score_pattern.match(l):
              rr = int(score_pattern.match(l).group(1))
        if rr != -1:
            results.append(rr)
        print(rr)
        p = prefix + "_" + str(jj)


print(f"Count {len(results)}/{count}, min {min(results)}, max {max(results)}, avg {numpy.mean(results)}")